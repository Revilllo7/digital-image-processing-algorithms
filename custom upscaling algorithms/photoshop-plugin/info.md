THIS IS SO UNOPTIMISED I AM NOT EVEN KIDDING YOU.

I LEARNT AFTERWARDS THAT PHOTOSHOP PLUGINS ARE SINGLE THREADED.

SINGLE. FUCKING. THREADED.

SO I DUNNO IF THIS WORKS. IT WOULD PROBABLY TAKE LITERAL HOURS TO TEST, CAUSE IT HAS SO MANY LOOPS.